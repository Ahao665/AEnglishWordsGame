<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesture Spelling Game</title>
  </head>
  <body>
    <div id="root"></div>

    <!-- 先注册 SW 并等其就绪，再加载 MediaPipe，这样 .wasm 请求会被 SW 修正 MIME -->
    <script>
      (function(){
        var base = (document.querySelector('base') && document.querySelector('base').getAttribute('href')) || '/';
        if (!base.endsWith('/')) base += '/';
        function loadScript(src) {
          return new Promise(function(resolve, reject) {
            var s = document.createElement('script');
            s.src = src;
            s.onload = resolve;
            s.onerror = reject;
            document.head.appendChild(s);
          });
        }
        function loadMediaPipe() {
          loadScript(base + 'mediapipe/hands.js')
            .then(function() { return loadScript(base + 'mediapipe/camera_utils/camera_utils.js'); })
            .then(function() { return loadScript(base + 'mediapipe/drawing_utils/drawing_utils.js'); })
            .catch(function(e) { console.error('MediaPipe scripts load error', e); });
        }
        if (!('serviceWorker' in navigator)) {
          loadMediaPipe();
          return;
        }
        navigator.serviceWorker.register(base + 'sw-wasm-mime.js').catch(function(){});
        Promise.race([
          navigator.serviceWorker.ready,
          new Promise(function(r) { setTimeout(r, 2500); })
        ]).then(loadMediaPipe);
      })();
    </script>

    <!-- React Main Entry -->
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>